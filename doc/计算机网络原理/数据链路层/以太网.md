# 以太网

## 1. 以太网的两个标准

* DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约。
* IEEE 的 802.3 标准。

DIX Ethernet V2 与 IEEE 的 802.3 标准只有很小的差别，因此可以将 802.3 局域网简称为“以太网”

严格说来，“以太网”应当是指符合 DIX Ethernet V2 标准的局域网。

## 2. 以太网与数据链路层的两个子层

为了使数据链路层能更好地适应多种局域网标准，802委员会将局域网的数据链路层拆成两个子层：
* 逻辑链路控制子层（LLC - Logical Link Control）
* 媒体接入控制子层（MAC - Medium Access Control）

与接入到传输媒体有关的内容都放在MAC子层，而LLC子层则与传输媒体无关，不管采用何种协议的局域网对LLC子层来说都是透明的。

由于TCP/IP 体系经常使用的局域网是 DIX Ethernet V2 而不是 802.3标准中的局域网，因此现在803委员会制定的逻辑链路控制子层LLC（802.2标准）的作用已不大。

很多厂商生产的适配器上仅装有 MAC 协议而没有LLC协议

## 3. 以太网提供的服务

以太网提供的服务是不可靠的交付，即尽最大努力的交付。

当接收站收到有差错的数据帧时就丢弃此帧，其他什么也不错。差错的纠正由高层来决定 - 传输层决定。

如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送。

## 4. 以太网的拓扑

传统以太网最初使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展为使用更便宜和更灵活的双绞线。不用电缆而使用无屏蔽双绞线。
每个站点需要用两队双绞线，分别用于发送和接收。


### 4.1 星型拓扑

这种以太网采用星型拓扑，在星型的中心则增加一种可靠性非常高的设备，叫集线器。

集线器起到放大的作用。

![computer-39.png](/doc/imgs/computer/computer-39.png)

### 4.2 集线器

**集线器**是使用电子器件来模拟实际电缆线的工作，因此整个系统仍然像一个传统的以太网那样运行。集线器使用了大规模集成电路芯片，因此这样的硬件设备的可靠性已大大提高了。

使用集线器的以太网在逻辑上仍是一个总线网，各个工作站使用 CSMA/CD 协议，并共享逻辑上的总线。

集线器很像一个多接口的转发器，工作在物理层。

![computer-40.png](/doc/imgs/computer/computer-40.png)


### 4.3 10BASE-T
* 10BASE-T的通信距离稍短，每个站到集线器的距离不超过100m。这种 10 Mb/s 速率的无屏蔽双绞线星形网的出现，既降低了成本，又提高了可靠性。
* 10BASE-T 双绞线以太网的出现，是局域网发展史上的一个非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢固的基础。

其他：100Base-FX、100Base-T 和 100Base-T4

## 5. 以太网的信道利用率

### 5.1 介绍

以太网的信道被占用的情况：争用期长度为2t，即端到端传播时延的两倍。检测到碰撞不发送干扰信号。

帧长为L（bit），数据发送速率为 C（b/s），因而帧的发送时间为 L/C = T0(s)

一个帧从开始发送，经可能发生的碰撞后，将再次重传次数，到发送成功且信道转为空闲（即再经过时间t使得信道上无信号在传播）时为止，是发送一帧所需的平均时间。

![computer-41.png](/doc/imgs/computer/computer-41.png)

```
        t
a = -----------
        T0
a: 以太网的信道利用率
t：以太网单程端到端时延
T0：帧的发送时间
```

* a --> 0，表示已发生碰撞就立即检测出来，并立即停止发送，因而信道利用率很高
* a越大，表明争用期所占的比例增大，每发生一次碰撞就浪费许多信道资源，使得信道利用率明显降低。

### 5.2 以太网的信道利用率的最大值

对以太网参数的要求：
* 当数据率一定时，以太网的连线长度受到限制，否则t的数值会太大
* 以太网的帧长不能太短，否则 T0 的值会太小，使a值太大

信道利用率的最大值：
* 在理想化的情况下，以太网上的各站发送数据都不会产生碰撞（这显然不是 CSMA/CD，而是需要使用一种特殊的调度方法），即
  总线一旦空闲就有某一个站立即发送数据
* 发送一帧占用线路的时间 T0 + t，而帧本身的发送时间是T0。于是我们可计算出理想情况下的极限信道利用率Smax为：

```
        T0          1
Smax = ------  = -------- 
        T0 + t     1 + a
```

## 6. MAC层的硬件地址（MAC地址）

### 6.1 MAC

在局域网中，硬件地址又称为物理地址或MAC地址。

802标准所说的“地址” 严格地讲应当是每一个站的“名字”或标识符。

* IEEE 的注册管理机构 RA 负责向厂家分配地址字段的前三个字节（即高位24位）
* 地址字段中的后三个字节（即低位24位）由厂家自行指派，称为**扩展标识符**，必须保证生产出的适配器没有重复地址。
* 一个地址块可以生成 2^24个不同的地址。这种48位地址称为 MAC-48，它的通用名称为 EUI-48
* “MAC地址”实际上就是适配器地址或适配器标识符 EUI-48 

### 6.2 适配器检查MAC地址

适配器从网络上每收到一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址
* 如果是发往本站的帧则收下，然后再进行其他的处理
* 否则就将此帧丢弃，不再进行其他的处理

“发往本站的帧”包括以下三种帧:
* 单播（unicast）帧 - 一对一
* 广播（broadcast）帧 - 一对全体
* 多播（multicast）帧 - 一对多

### 6.3 MAC帧格式

![computer-42.png](/doc/imgs/computer/computer-42.png)

* 在帧的前面插入的8字节中的第一个字段共7个字节，是前同步码，用来迅速实现 MAC 帧的比特同步。
  第二个字段是帧开始界定符，表示后面的信息就是 MAC 帧。
* 为了达到比特同步，在传输媒体上实际传送要比 MAC 帧还多8个

### 6.4 无效的 MAC 帧

* 帧的长度不是整数个字节
* 用收到的帧检验序列 FCS 查出有错误
* 数据字段的长度不在46 - 1500字节之间
* 有效的 MAC 帧长度为 64 - 1518字节之间
* 对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧

### 6.5 帧间最小间隔

帧间最小间隔为 9.6微秒，相当于96bit的发送时间。

一个站在检测到总线开始空闲时，还要等待9.6微秒才能再次发送数据。这样做是为了使刚刚收到数据帧的站的接收缓存来得及清理，做好接收下一帧的准备。









